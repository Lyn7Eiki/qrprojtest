<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCTG Pocket - 官方高清版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        body { background-color: #04060b; color: white; overflow-x: hidden; font-family: system-ui, -apple-system, sans-serif; }

        /* 背景流光效果 */
        .bg-mesh {
            position: fixed; inset: 0;
            background: radial-gradient(circle at 10% 20%, #1e3a8a 0%, transparent 40%),
                        radial-gradient(circle at 90% 80%, #4c1d95 0%, transparent 40%);
            z-index: -1;
        }

        /* 3D 卡牌容器 - 响应式高度 */
        .card-container {
            perspective: 1200px;
            aspect-ratio: 2.5 / 3.5;
            width: 100%;
            max-width: 240px; /* 限制最大宽度防止过大 */
            margin: 0 auto;
        }

        .card-inner {
            position: relative;
            width: 100%; height: 100%;
            transition: transform 0.7s cubic-bezier(0.175, 0.885, 0.32, 1.2);
            transform-style: preserve-3d;
            cursor: pointer;
        }

        .card-inner.is-flipped { transform: rotateY(180deg); }

        .card-face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden;
            border-radius: 4.5% / 3.2%; /* 模拟官方卡牌圆角 */
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            overflow: hidden;
        }

        /* 背面：你提供的图2链接 */
        .card-back {
            background-image: url('https://image.pokemon.com.cn/wp-content/uploads/2025/11/tcg-img-basic-3.png');
            background-size: 100% 100%;
            background-position: center;
        }

        /* 正面：由 API 提供高清大图 */
        .card-front {
            transform: rotateY(180deg);
            background-color: #eee;
        }
        .card-front img { width: 100%; height: 100%; object-fit: fill; }

        /* 稀有卡特殊闪光层 */
        .holo-overlay {
            position: absolute; inset: 0;
            background: linear-gradient(125deg, transparent 0%, rgba(255,255,255,0.3) 45%, rgba(255,255,255,0.5) 50%, rgba(255,255,255,0.3) 55%, transparent 100%);
            background-size: 250% 250%;
            animation: holo-move 5s infinite linear;
            pointer-events: none;
            mix-blend-mode: overlay;
            z-index: 10;
        }
        @keyframes holo-move {
            0% { background-position: 200% 200%; }
            100% { background-position: -200% -200%; }
        }

        .pack-vibrate { animation: vibrate 0.1s infinite; }
        @keyframes vibrate {
            0% { transform: translate(1px, 1px); }
            50% { transform: translate(-1px, -2px); }
            100% { transform: translate(1px, -1px); }
        }
    </style>
</head>
<body>

<div id="app" class="min-h-screen flex flex-col items-center justify-center p-4">
    <div class="bg-mesh"></div>

    <!-- 1. 选包界面 -->
    <div v-if="view === 'SELECT'" class="w-full max-w-4xl animate__animated animate__fadeIn">
        <h1 class="text-3xl md:text-5xl font-black italic text-center mb-12 tracking-tighter">
            POKÉMON <span class="text-yellow-400">POCKET</span>
        </h1>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-8 md:gap-12 px-8">
            <div v-for="p in packs" :key="p.id" @click="openAction(p)" 
                 class="cursor-pointer group flex flex-col items-center">
                <img :src="p.img" class="w-48 md:w-64 drop-shadow-[0_20px_50px_rgba(0,0,0,0.7)] transition-transform duration-300 group-hover:scale-110 group-active:scale-95">
            </div>
        </div>
    </div>

    <!-- 2. 开包过程 -->
    <div v-if="view === 'OPENING'" class="w-full flex flex-col items-center">
        <!-- 撕包环节 -->
        <div v-if="!isRipped" @click="ripAction" class="cursor-pointer flex flex-col items-center">
            <img :src="activePack.img" class="w-64 md:w-80" :class="{'pack-vibrate': isVibrating}">
            <div class="mt-10 bg-yellow-400 text-black px-12 py-3 rounded-full font-black text-lg animate-bounce shadow-2xl">
                撕开卡包
            </div>
        </div>

        <!-- 卡牌展示区：自适应 Grid -->
        <div v-if="isRipped" class="w-full max-w-6xl animate__animated animate__fadeIn">
            <!-- 核心：上3下3布局，响应式适配 -->
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4 md:gap-10">
                <div v-for="(card, i) in currentCards" :key="i" class="card-container">
                    <div class="card-inner" :class="{'is-flipped': card.revealed}" @click="card.revealed = true">
                        <!-- 背面 (图2) -->
                        <div class="card-face card-back"></div>
                        <!-- 正面 (API 高清图) -->
                        <div class="card-face card-front">
                            <img :src="card.hiResImg" @error="handleImgError">
                            <div v-if="card.isRare" class="holo-overlay"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 完成 -->
            <div class="mt-12 text-center">
                <button v-if="allRevealed" @click="view = 'SELECT'" 
                        class="bg-white text-blue-900 px-16 py-3 rounded-full font-black text-xl shadow-2xl hover:bg-yellow-400 transition-all">
                    收下全部卡牌
                </button>
                <p v-else class="text-yellow-400 font-black tracking-widest animate-pulse">点击每一张卡牌来翻开它</p>
            </div>
        </div>
    </div>

    <!-- 全屏加载 -->
    <div v-if="loading" class="fixed inset-0 bg-black/95 z-50 flex flex-col items-center justify-center">
        <div class="w-12 h-12 border-4 border-yellow-400 border-t-transparent rounded-full animate-spin"></div>
        <p class="mt-6 font-black text-yellow-400 tracking-widest italic">正在从官网同步高清卡面...</p>
    </div>
</div>

<script>
    const { createApp, ref, computed } = Vue;

    createApp({
        setup() {
            const view = ref('SELECT');
            const loading = ref(false);
            const isVibrating = ref(false);
            const isRipped = ref(false);
            const activePack = ref(null);
            const currentCards = ref([]);

            const packs = [
                { id: '151a', img: 'https://image.pokemon.com.cn/wp-content/uploads/2025/09/accb6c04e358f172fffdc6ea0a0e77c40d1f64b0-scaled.png', set: 'sv3pt5' }, // 官方151集合
                { id: '151b', img: 'https://image.pokemon.com.cn/wp-content/uploads/2025/09/2b62dd5a724064a784b7b76a67231c7a795febcd-scaled.png', set: 'sv3pt5' },
                { id: 'gen', img: 'https://image.pokemon.com.cn/wp-content/uploads/2025/01/151_5_1_5-effect-picture-thumb-600xauto-26551.png', set: 'sv4' }   // 帕底亚进化
            ];

            const openAction = async (pack) => {
                loading.value = true;
                activePack.value = pack;
                try {
                    // 使用 pokemontcg.io 的 API 获取对应系列的卡牌
                    // 随机获取 6 张卡
                    const response = await fetch(`https://api.pokemontcg.io/v2/cards?q=set.id:${pack.set}&pageSize=50`);
                    const data = await response.json();
                    
                    // 随机打乱并取6张
                    const shuffled = data.data.sort(() => 0.5 - Math.random());
                    const selected = shuffled.slice(0, 6);

                    currentCards.value = selected.map(c => ({
                        hiResImg: c.images.large, // 获取官方高清大图
                        isRare: c.rarity && c.rarity.includes('Rare'),
                        revealed: false
                    }));

                    view.value = 'OPENING';
                    isRipped.value = false;
                } catch (e) {
                    alert("API 链接不稳定，请重试");
                } finally {
                    loading.value = false;
                }
            };

            const ripAction = () => {
                isVibrating.value = true;
                setTimeout(() => {
                    isVibrating.value = false;
                    isRipped.value = true;
                }, 700);
            };

            const allRevealed = computed(() => {
                return currentCards.value.length > 0 && currentCards.value.every(c => c.revealed);
            });

            const handleImgError = (e) => {
                e.target.src = "https://images.pokemontcg.io/sv3pt5/1_hires.png"; // 备用图
            };

            return { view, packs, activePack, currentCards, openAction, ripAction, isVibrating, isRipped, loading, allRevealed, handleImgError };
        }
    }).mount('#app');
</script>

</body>
</html>